## OWASP 10 categories
The OWASP Top 10 is a standard awareness document for developers and web application security. It represents a broad consensus about the most critical security risks to web applications. When integrating security into your CI/CD pipeline, it's essential to consider these risks and implement checks to mitigate them.

Here are the OWASP Top 10 risks and corresponding CI/CD checks you can implement:

1. Injection
Check: Use static analysis tools to detect potential injection vulnerabilities (e.g., SQL injection, command injection).
Tools: SonarQube, Checkmarx, Snyk
2. Broken Authentication
Check: Ensure that authentication mechanisms are robust and not vulnerable to attacks like brute force.
Tools: OWASP ZAP, Burp Suite, custom scripts for brute force testing
3. Sensitive Data Exposure
Check: Scan for hardcoded secrets, ensure data encryption in transit and at rest.
Tools: TruffleHog, GitLeaks, Talisman
4. XML External Entities (XXE)
Check: Use static analysis tools to detect XXE vulnerabilities.
Tools: SonarQube, Checkmarx
5. Broken Access Control
Check: Perform access control testing to ensure proper authorization checks are in place.
Tools: OWASP ZAP, Burp Suite
6. Security Misconfiguration
Check: Scan for misconfigurations in your infrastructure and applications.
Tools: OpenVAS, Nessus, CIS-CAT
7. Cross-Site Scripting (XSS)
Check: Use static and dynamic analysis tools to detect XSS vulnerabilities.
Tools: SonarQube, OWASP ZAP, Burp Suite
8. Insecure Deserialization
Check: Use static analysis tools to detect insecure deserialization vulnerabilities.
Tools: SonarQube, Checkmarx
9. Using Components with Known Vulnerabilities
Check: Scan dependencies for known vulnerabilities.
Tools: Snyk, Dependabot, OWASP Dependency-Check
10. Insufficient Logging & Monitoring
Check: Ensure that logging and monitoring are in place and configured correctly.
Tools: ELK Stack (Elasticsearch, Logstash, Kibana), Splunk, Prometheus

- https://www.zaproxy.org/docs/docker/baseline-scan/

# pull docker image
  docker pull -t ghcr.io/zaproxy/zaproxy:stable

# run interactive tests
  docker run -ti  ghcr.io/zaproxy/zaproxy:stable bash

```bash
zap@c8bfd92eafb0:/zap$ zap-baseline.py
2024-09-09 12:59:38,691 Target must start with 'http://' or 'https://'
Usage: zap-baseline.py -t <target> [options]
    -t target         target URL including the protocol, e.g. https://www.example.com
Options:
    -h                print this help message
    -c config_file    config file to use to INFO, IGNORE or FAIL warnings
    -u config_url     URL of config file to use to INFO, IGNORE or FAIL warnings
    -g gen_file       generate default config file (all rules set to WARN)
    -m mins           the number of minutes to spider for (default 1)
    -r report_html    file to write the full ZAP HTML report
    -w report_md      file to write the full ZAP Wiki (Markdown) report
    -x report_xml     file to write the full ZAP XML report
    -J report_json    file to write the full ZAP JSON document
    -a                include the alpha passive scan rules as well
    -d                show debug messages
    -P                specify listen port
    -D secs           delay in seconds to wait for passive scanning 
    -i                default rules not in the config file to INFO
    -I                do not return failure on warning
    -j                use the Ajax spider in addition to the traditional one
    -l level          minimum level to show: PASS, IGNORE, INFO, WARN or FAIL, use with -s to hide example URLs
    -n context_file   context file which will be loaded prior to spidering the target
    -p progress_file  progress file which specifies issues that are being addressed
    -s                short output format - dont show PASSes or example URLs
    -T mins           max time in minutes to wait for ZAP to start and the passive scan to run
    -U user           username to use for authenticated scans - must be defined in the given context file
    -z zap_options    ZAP command line options e.g. -z "-config aaa=bbb -config ccc=ddd"
    --hook            path to python file that define your custom hooks
    --auto            use the automation framework if supported for the given parameters (this is now the default)
    --autooff         do not use the automation framework even if supported for the given parameters
```

## with docker mount
```
  docker run --user root -v $(pwd):/zap/wrk/:rw --network=host -t ghcr.io/zaproxy/zaproxy:stable zap-baseline.py -t https://ntfy.guggenbuehl.net -J report_json.json -w report_md.md -r report_html.html -a

$ ls
report_html.html  report_json.json  report_md.md  zap.yaml
```

![report](https://github.com/user-attachments/assets/ffaae9d7-5d9a-4968-b75b-f6931388cadc)

 
# run test in a CI example

## github action
 - .github/workflows/blank.yml

## GITLAB
```
# vi . .gitlab-ci.yml
stages:
  - lint
  - test
  - security
  - deploy

variables:
  PIP_CACHE_DIR: "$CI_PROJECT_DIR/.cache/pip"

before_script:
  - python -m venv venv
  - source venv/bin/activate
  - pip install --upgrade pip
  - pip install -r requirements.txt

lint:
  stage: lint
  script:
    - flake8 .

test:
  stage: test
  script:
    - pytest

security_static_analysis:
  stage: security
  script:
    - pip install bandit
    - bandit -r .

dependency_check:
  stage: security
  script:
    - pip install safety
    - safety check

secrets_scan:
  stage: security
  script:
    - pip install detect-secrets
    - detect-secrets scan > .secrets.baseline
    - detect-secrets audit .secrets.baseline

dynamic_analysis:
  stage: security
  script:
    - docker run -t owasp/zap2docker-stable zap-baseline.py -t http://your-app-url

deploy:
  stage: deploy
  script:
    - echo "Deploying to production..."
    - # Add your deployment commands here
  only:
    - master
```
